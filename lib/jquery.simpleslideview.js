// Generated by CoffeeScript 1.6.2
(function() {
  var $, SimpleSlideView, defaults, outerHeight, outerWidth, resetStyles;

  $ = typeof jQuery !== "undefined" && jQuery !== null ? jQuery : Zepto;

  defaults = {
    views: '.view',
    activeView: null,
    duration: $.fx.speeds._default,
    easing: (typeof Zepto !== "undefined" && Zepto !== null) && (typeof jQuery === "undefined" || jQuery === null) ? 'ease-out' : 'swing',
    useTransformProps: typeof Zepto !== "undefined" && Zepto !== null,
    cssPrefix: $.fx.cssPrefix != null ? $.fx.cssPrefix : '',
    dataAttrEvent: 'click',
    dataAttr: {
      push: 'pushview',
      pop: 'popview'
    },
    eventNames: {
      viewChangeStart: 'viewChangeStart',
      viewChangeEnd: 'viewChangeEnd'
    }
  };

  resetStyles = function(el, styles) {
    var $el, reset, style, _i, _len;

    $el = $(el);
    reset = {};
    for (_i = 0, _len = styles.length; _i < _len; _i++) {
      style = styles[_i];
      reset[style] = '';
    }
    return $el.css(reset);
  };

  outerHeight = function(el) {
    if ($.fn.outerHeight != null) {
      return $(el).outerHeight();
    }
    return $(el).height();
  };

  outerWidth = function(el) {
    if ($.fn.outerWidth != null) {
      return $(el).outerWidth();
    }
    return $(el).width();
  };

  SimpleSlideView = (function() {
    function SimpleSlideView(element, options) {
      this.options = $.extend(true, {}, defaults, options);
      this.$container = $(element);
      this.$views = this.$container.find(this.options.views);
      this.$activeView = this.options.activeView != null ? $(this.options.activeView) : this.$views.first();
    }

    SimpleSlideView.prototype.on = function() {
      var _this = this;

      this.$views.not(this.$activeView).css('display', 'none');
      if (this.options.dataAttrEvent != null) {
        this.$container.on(this.options.dataAttrEvent, '[data-' + this.options.dataAttr.push + ']', function(event) {
          var $el, target;

          $el = $(event.currentTarget);
          target = $el.data(_this.options.dataAttr.push);
          if (!target.length) {
            target = $el.attr('href');
          }
          if (target.length) {
            event.preventDefault();
            return _this.pushView(target);
          }
        });
        return this.$container.on(this.options.dataAttrEvent, '[data-' + this.options.dataAttr.pop + ']', function(event) {
          var $el, target;

          $el = $(event.currentTarget);
          target = $el.data(_this.options.dataAttr.pop);
          if (!target.length) {
            target = $el.attr('href');
          }
          if (target.length) {
            event.preventDefault();
            return _this.popView(target);
          }
        });
      }
    };

    SimpleSlideView.prototype.off = function() {
      this.$views.css('display', '');
      if (this.options.dataAttrEvent != null) {
        this.$container.off(this.options.dataAttrEvent, '[data-' + this.options.dataAttr.push + ']');
        return this.$container.off(this.options.dataAttrEvent, '[data-' + this.options.dataAttr.pop + ']');
      }
    };

    SimpleSlideView.prototype.changeView = function(targetView, push) {
      var $bothViews, $targetView, containerWidth, inAnimProps, outAnimProps, resetProps, transformProp,
        _this = this;

      this.$container.trigger(this.options.eventNames.viewChangeStart);
      $targetView = $(targetView);
      $bothViews = this.$activeView.add($targetView);
      containerWidth = outerWidth(this.$container);
      outAnimProps = {};
      inAnimProps = {};
      resetProps = ['left', 'position', 'top', 'width'];
      this.$container.css({
        height: outerHeight(this.$container),
        overflow: 'hidden',
        position: 'relative',
        width: '100%'
      });
      $bothViews.css({
        position: 'absolute',
        top: 0,
        width: containerWidth
      });
      if (this.options.useTransformProps) {
        transformProp = this.options.cssPrefix + 'transform';
        resetProps.push(transformProp);
        $bothViews.css('left', 0);
        $targetView.css(transformProp, 'translateX(' + (push ? 100 : -100) + '%)');
        outAnimProps[transformProp] = 'translateX(' + (push ? -100 : 100) + '%)';
        inAnimProps[transformProp] = 'translateX(0)';
      } else {
        this.$activeView.css('left', 0);
        $targetView.css('left', push ? containerWidth : containerWidth * -1);
        outAnimProps['left'] = push ? containerWidth * -1 : containerWidth;
        inAnimProps['left'] = 0;
      }
      $targetView.show();
      this.$activeView.animate(outAnimProps, this.options.duration, this.options.easing, function() {
        return resetStyles(this, resetProps).hide();
      });
      $targetView.animate(inAnimProps, this.options.duration, this.options.easing, function() {
        return resetStyles(this, resetProps);
      });
      this.$container.animate({
        height: outerHeight($targetView)
      }, this.options.duration, this.options.easing, function() {
        resetStyles(_this.$container, ['height', 'overflow', 'position', 'width']);
        return _this.$container.trigger(_this.options.eventNames.viewChangeEnd);
      });
      return this.$activeView = $targetView;
    };

    SimpleSlideView.prototype.pushView = function(targetView) {
      return this.changeView(targetView, true);
    };

    SimpleSlideView.prototype.popView = function(targetView) {
      return this.changeView(targetView);
    };

    return SimpleSlideView;

  })();

  $.fn.simpleSlideView = function(options, extras) {
    if (options == null) {
      options = {};
    }
    if (typeof options !== 'object') {
      options = {
        views: options
      };
    }
    if (typeof extras === 'object') {
      $.extend(options, extras);
    }
    return new SimpleSlideView(this, options);
  };

}).call(this);
