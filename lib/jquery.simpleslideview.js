// Generated by CoffeeScript 1.6.3
(function() {
  var $;

  $ = jQuery;

  $.SimpleSlideView = function(options) {
    var $active, $container, $views, actions, cssSupport, isActive, settings, transEndEventName, transEndEventNames, transformPrefix;
    settings = {
      container: ".views",
      views: ".view",
      active: false,
      duration: 500
    };
    settings = $.extend(settings, options);
    $container = $(settings.container);
    $views = $(settings.views, $container);
    $active = settings.active ? $(active) : $views.first();
    isActive = false;
    cssSupport = (typeof Modernizr !== "undefined" && Modernizr !== null) && Modernizr.csstransforms && Modernizr.csstransitions;
    transEndEventNames = {
      'WebkitTransition': 'webkitTransitionEnd',
      'MozTransition': 'transitionend',
      'OTransition': 'oTransitionEnd otransitionend',
      'msTransition': 'MSTransitionEnd',
      'transition': 'transitionend'
    };
    if (cssSupport) {
      transformPrefix = Modernizr.prefixed('transform').replace(/([A-Z])/g, function(str, m1) {
        return '-' + m1.toLowerCase();
      }).replace(/^ms-/, '-ms-');
      transEndEventName = transEndEventNames[Modernizr.prefixed('transition')];
    }
    actions = {
      slideView: function(target, push) {
        var $target, containerWidth;
        $target = $(target);
        containerWidth = $container.width();
        $container.css({
          height: $container.outerHeight(),
          overflow: "hidden",
          position: "relative",
          width: "100%"
        });
        if (cssSupport) {
          return actions.animateCSS($target, push, containerWidth);
        } else {
          return actions.animateJS($target, push, containerWidth);
        }
      },
      animateCSS: function($target, push, containerWidth) {
        var distance;
        distance = push ? containerWidth * -1 : containerWidth;
        $target.show(0, function() {
          $active.css({
            transition: transformPrefix + " " + settings.duration + "ms ease",
            transform: "translateX(" + distance + "px)"
          });
          $target.css({
            transition: transformPrefix + " " + settings.duration + "ms ease",
            transform: "translateX(" + distance + "px)"
          });
          $container.css({
            transition: "height " + settings.duration + "ms linear",
            height: $target.outerHeight() + "px"
          });
          if ($(window).scrollTop() > $container.position().top) {
            return $.scrollTo($container, settings.duration);
          }
        }).css({
          left: push ? containerWidth : containerWidth * -1,
          position: "absolute",
          top: 0,
          width: containerWidth
        });
        return $(window).on(transEndEventName, function() {
          $target.attr("style", "");
          $active.attr("style", "").hide();
          $(window).off(transEndEventName);
          return $active = $target;
        });
      },
      animateJS: function($target, push, containerWidth) {
        $active.css({
          left: 0,
          position: "absolute",
          top: 0,
          width: containerWidth
        }).animate({
          left: push ? containerWidth * -1 : containerWidth
        }, function() {
          return $(this).attr("style", "").hide();
        });
        $target.show().css({
          left: push ? containerWidth : containerWidth * -1,
          position: "absolute",
          top: 0,
          width: containerWidth
        }).animate({
          left: 0
        }, function() {
          return $(this).attr("style", "");
        });
        $container.animate({
          height: $target.outerHeight()
        });
        if ($(window).scrollTop() > $container.position().top) {
          $.scrollTo($container, settings.duration);
        }
        return $active = $target;
      },
      on: function() {
        if (isActive) {
          return;
        }
        isActive = true;
        $views.not($active).css("display", "none");
        return $container.on("touchstart mousedown", "[data-pushview]", function(event) {
          event.preventDefault();
          return actions.pushView($(this).data("pushview"));
        }).on("touchstart mousedown", "[data-popview]", function(event) {
          event.preventDefault();
          return actions.popView($(this).data("popview"));
        }).on("click", "[data-pushview]", function(e) {
          return e.preventDefault().on("click", "[data-popview]", function(e) {
            return e.preventDefault();
          });
        });
      },
      off: function() {
        if (!isActive) {
          return;
        }
        isActive = false;
        $container.add($views).stop();
        $container.css({
          height: "",
          overflow: "",
          position: "",
          width: ""
        });
        $views.css({
          left: "",
          position: "",
          top: "",
          width: ""
        });
        $container.off("touchstart mousedown click", "[data-pushview]");
        $container.off("touchstart mousedown click", "[data-popview]");
        return $views.css("display", "");
      },
      pushView: function(target) {
        return actions.slideView(target, true);
      },
      popView: function(target) {
        return actions.slideView(target);
      }
    };
    return {
      on: actions.on,
      off: actions.off,
      pushView: actions.pushView,
      popView: actions.popView
    };
  };

}).call(this);
